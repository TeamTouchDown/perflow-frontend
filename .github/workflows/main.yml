name: Stage Build # Action의 이름 
on:  
  push:    
    branches:      
      - deploy # 브랜치의 push 이벤트에 의해 트리거 됩니다. 
jobs:  
  build:    
    runs-on: ubuntu-18.04 # ubuntu 18.04 컨테이너를 이용합니다.    
    steps:      
      - name: Checkout source code.           
        uses: actions/checkout@stage # stage branch를 체크아웃 합니다.       
      - name: Cache node modules             
        uses: actions/cache@v1        
        with:          
          path: node_modules          
          key: ${{ runner.OS }}-build-${{ hashFiles('**/package-lock.json') }}          
          restore-keys: |            
            ${{ runner.OS }}-build-            
            ${{ runner.OS }}-      
      - name: Install Dependencies # 의존성 패키지 설치        
        run: npm install        
      - name: Build # 프로젝트 빌드                     
        run: npm run build       
      - name: Deploy           
        env:          
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}          
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}        
        run: |         
          aws s3 cp \            
            --recursive \            
            --region ap-northeast-2 \            
            dist s3://perflow-frontend-bucket # 이부분을 s3 버킷 이름으로 변경합니다.
